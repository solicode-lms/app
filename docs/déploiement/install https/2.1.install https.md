### ğŸš€ **Tutoriel complet : Configurer HTTPS en local avec un certificat SSL auto-signÃ© et un DNS pour un rÃ©seau LAN sous Ubuntu et Windows**  

Si tu veux accÃ©der Ã  ton serveur via un **nom de domaine local sÃ©curisÃ© (`https://monapp.local`)** ou une **IP locale (`https://192.168.1.251`)** sans erreur de certificat, voici un guide **de A Ã  Z** ! ğŸ“–

---

# âœ… **1. Installer Nginx et OpenSSL**
Sur **Ubuntu**, installe Nginx et OpenSSL :
```bash
sudo apt update
sudo apt install nginx openssl -y
```
VÃ©rifie que **Nginx tourne** :
```bash
sudo systemctl status nginx
```
Si Nginx nâ€™est pas actif, dÃ©marre-le :
```bash
sudo systemctl start nginx
```

---

# âœ… **2. GÃ©nÃ©rer un certificat SSL auto-signÃ© avec un SAN (Subject Alternative Name)**
Les navigateurs modernes **n'acceptent plus les certificats sans SAN**, donc on doit le configurer correctement.

### **ğŸ“Œ 1ï¸âƒ£ CrÃ©er un fichier de configuration `san.cnf`**
CrÃ©e un fichier pour les options SSL :
```bash
sudo nano /etc/nginx/ssl/san.cnf
```
Ajoute ceci (modifie selon ton IP et domaine) :
```
[req]
distinguished_name = req_distinguished_name
x509_extensions = v3_ca
prompt = no

[req_distinguished_name]
CN = monapp.local  # Mets ici ton nom de domaine ou IP

[v3_req]
keyUsage = critical, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth
subjectAltName = @alt_names

[alt_names]
DNS.1 = monapp.local
IP.1 = 192.168.1.251
```
âœ”ï¸ **Ce fichier permet au certificat de fonctionner sur `monapp.local` et `192.168.1.251`.**

---

### **ğŸ“Œ 2ï¸âƒ£ GÃ©nÃ©rer la clÃ© privÃ©e**
```bash
openssl genrsa -out /etc/nginx/ssl/server.key 2048
```

---

### **ğŸ“Œ 3ï¸âƒ£ GÃ©nÃ©rer une requÃªte de certificat (CSR)**
```bash
openssl req -new -key /etc/nginx/ssl/server.key -out /etc/nginx/ssl/server.csr -config /etc/nginx/ssl/san.cnf
```

---

### **ğŸ“Œ 4ï¸âƒ£ Signer le certificat**
```bash
openssl x509 -req -days 365 -in /etc/nginx/ssl/server.csr -signkey /etc/nginx/ssl/server.key -out /etc/nginx/ssl/server.crt -extensions v3_req -extfile /etc/nginx/ssl/san.cnf
```
âœ” **Le certificat est gÃ©nÃ©rÃ© et valable pour `monapp.local` et `192.168.1.251`.**

---

# âœ… **3. Configurer Nginx avec le certificat SSL**
Ouvre la configuration Nginx :
```bash
sudo nano /etc/nginx/sites-available/default
```
Modifie le fichier comme suit :
```nginx
server {
    listen 80;
    server_name monapp.local 192.168.1.251;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name monapp.local 192.168.1.251;

    ssl_certificate /etc/nginx/ssl/server.crt;
    ssl_certificate_key /etc/nginx/ssl/server.key;

    root /var/www/app/public;
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.ht {
        deny all;
    }
}
```
âœ” **Cette configuration redirige HTTP vers HTTPS et active le certificat.**

RedÃ©marre Nginx :
```bash
sudo systemctl restart nginx
```

---

# âœ… **4. Ajouter le certificat SSL Ã  Windows**
Si tu veux Ã©viter l'erreur **"NET::ERR_CERT_AUTHORITY_INVALID"**, tu dois ajouter le certificat Ã  **Windows**.

1ï¸âƒ£ **Copie le certificat vers Windows**
Sur Ubuntu, convertis-le en `.cer` :
```bash
openssl x509 -outform der -in /etc/nginx/ssl/server.crt -out server.cer
```
Puis, transfÃ¨re `server.cer` sur Windows (via clÃ© USB ou SCP).

2ï¸âƒ£ **Ajouter Ã  Windows**
- `Win + R` â†’ Tape `certmgr.msc`
- Va dans **AutoritÃ©s de certification racines de confiance** â†’ **Certificats**
- Clic droit â†’ **Importer** â†’ SÃ©lectionne `server.cer`
- Valide l'importation.

3ï¸âƒ£ **RedÃ©marrer Chrome et Edge**
```bash
chrome://restart
```
âœ” **Ton site est maintenant sÃ©curisÃ© et reconnu comme valide ! ğŸ‰**

---

# âœ… **5. Configurer un DNS local (LAN)**
Si tu veux que **tous les appareils du rÃ©seau accÃ¨dent Ã  `monapp.local`**, installe **dnsmasq**.

### **ğŸ“Œ 1ï¸âƒ£ Installer dnsmasq**
```bash
sudo apt install dnsmasq -y
```

### **ğŸ“Œ 2ï¸âƒ£ Configurer dnsmasq**
Ouvre le fichier de config :
```bash
sudo nano /etc/dnsmasq.conf
```
Ajoute :
```
listen-address=192.168.1.251,127.0.0.1
address=/monapp.local/192.168.1.251
```
âœ” Cela fait pointer `monapp.local` vers ton serveur.

RedÃ©marre dnsmasq :
```bash
sudo systemctl restart dnsmasq
```

---

### **ğŸ“Œ 3ï¸âƒ£ Dire au routeur dâ€™utiliser ce DNS**
1. **Va dans lâ€™interface du routeur (`192.168.1.1`)**
2. Trouve les paramÃ¨tres **DHCP**.
3. Mets **192.168.1.251** comme **serveur DNS principal**.

âœ” Maintenant, **tous les PC du rÃ©seau pourront accÃ©der Ã  `https://monapp.local` sans configuration manuelle !** ğŸ‰

---

# âœ… **Test final**
VÃ©rifie depuis n'importe quel PC du rÃ©seau :
```bash
nslookup monapp.local
```
âœ” Ã‡a doit renvoyer `192.168.1.251`.

Dans Chrome :
```
https://monapp.local
```
âœ” **Plus d'erreur ! Le SSL fonctionne ! ğŸ”¥**

---

# ğŸ¯ **RÃ©sumÃ©**
| Ã‰tape | Action |
|-------|--------|
| **1** | Installer **Nginx** et **OpenSSL** |
| **2** | GÃ©nÃ©rer un **certificat SSL** avec **SAN** |
| **3** | Configurer **Nginx** pour utiliser HTTPS |
| **4** | Ajouter le **certificat Ã  Windows** pour Ã©viter les erreurs |
| **5** | Installer un **DNS local (dnsmasq)** pour tout le rÃ©seau |
| **6** | Configurer le **routeur DHCP** pour utiliser ton DNS |

---

âœ… **Maintenant, ton serveur est sÃ©curisÃ© en HTTPS et accessible depuis tout ton rÃ©seau en `https://monapp.local` sans alerte de certificat !** ğŸ‰

Besoin d'aide ? ğŸ˜Š