### ğŸš€ **Tutoriel complet : Configurer HTTPS en local avec un certificat SSL auto-signÃ© et un DNS pour un rÃ©seau LAN sous Ubuntu et Windows**

Si tu veux accÃ©der Ã  ton serveur via un **nom de domaine local sÃ©curisÃ© (`https://monapp.local`)** ou une **IP locale (`https://192.168.1.251`)** sans erreur de certificat, voici un guide **de A Ã  Z** ! ğŸ“š

---

# âœ… **1. Installer Nginx et OpenSSL**

Sur **Ubuntu**, installe Nginx et OpenSSL :

```bash
sudo apt update
sudo apt install nginx openssl -y
```

VÃ©rifie que **Nginx tourne** :

```bash
sudo systemctl status nginx
```

Si Nginx nâ€™est pas actif, dÃ©marre-le :

```bash
sudo systemctl start nginx
```

---

# âœ… **2. GÃ©nÃ©rer un certificat SSL auto-signÃ© avec un SAN (Subject Alternative Name)**

Les navigateurs modernes **n'acceptent plus les certificats sans SAN**, donc on doit le configurer correctement.

### ğŸ“Œ 1ï¸âƒ£ CrÃ©er un fichier de configuration `san.cnf`

CrÃ©e un fichier pour les options SSL :

```bash
sudo nano /etc/nginx/ssl/san.cnf
```

Ajoute ceci (modifie selon ton IP et domaine) :

```
[req]
distinguished_name = req_distinguished_name
x509_extensions = v3_req
prompt = no

[req_distinguished_name]
CN = monapp.local  # Mets ici ton nom de domaine ou IP

[v3_req]
basicConstraints = critical, CA:TRUE
keyUsage = critical, keyCertSign, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth
subjectAltName = @alt_names

[alt_names]
DNS.1 = monapp.local
IP.1 = 192.168.1.251
```

ğŸ“… **Ce fichier permet au certificat de fonctionner sur `monapp.local` et `192.168.1.251`.**

---

### ğŸ“Œ 2ï¸âƒ£ GÃ©nÃ©rer la clÃ© privÃ©e

```bash
sudo openssl genrsa -out /etc/nginx/ssl/server.key 2048
```

---

### ğŸ“Œ 3ï¸âƒ£ GÃ©nÃ©rer une requÃªte de certificat (CSR)

```bash
sudo openssl req -new -key /etc/nginx/ssl/server.key -out /etc/nginx/ssl/server.csr -config /etc/nginx/ssl/san.cnf
```

---

### ğŸ“Œ 4ï¸âƒ£ Signer le certificat

```bash
sudo openssl x509 -req -days 365 -in /etc/nginx/ssl/server.csr -signkey /etc/nginx/ssl/server.key -out /etc/nginx/ssl/server.crt -extensions v3_req -extfile /etc/nginx/ssl/san.cnf
```

ğŸ“… **Le certificat est gÃ©nÃ©rÃ© et valable pour `monapp.local` et `192.168.1.251`.**

---

# âœ… **3. Configurer Nginx avec le certificat SSL**

Ouvre la configuration Nginx :

```bash
sudo nano /etc/nginx/sites-available/default
```

Modifie le fichier comme suit :

```nginx
server {
    listen 80;
    server_name monapp.local 192.168.1.251;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name monapp.local 192.168.1.251;

    ssl_certificate /etc/nginx/ssl/server.crt;
    ssl_certificate_key /etc/nginx/ssl/server.key;

    root /var/www/app/public;
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.ht {
        deny all;
    }
}
```

ğŸ“… **Cette configuration redirige HTTP vers HTTPS et active le certificat.**

RedÃ©marre Nginx :

```bash
sudo systemctl restart nginx
```

---

# âœ… **4. Ajouter le certificat SSL Ã  Windows**

Sur Ubuntu, convertis le certificat pour Windows :

```bash
sudo openssl x509 -outform der -in /etc/nginx/ssl/server.crt -out server.cer
```

TransfÃ¨re `server.cer` sur Windows et exÃ©cute dans PowerShell (Admin) :

```powershell
Import-Certificate -FilePath "C:\\path\\to\\server.cer" -CertStoreLocation Cert:\\LocalMachine\\Root
```

RedÃ©marre Chrome et Edge :

```bash
chrome://restart
```

ğŸ“… **Ton site est maintenant sÃ©curisÃ© et reconnu comme valide !**

---

# ğŸ¯ **Test final**

```bash
nslookup monapp.local
```

Dans Chrome :

```
https://monapp.local
```

ğŸ“… **Plus d'erreur ! Le SSL fonctionne !** ğŸ”¥

