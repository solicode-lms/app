#### Tâche : Ajouter un Champ Calculable

Pour ajouter un champ calculable dans une entité, il faut :

- Créer un champ avec l’attribut `calculable = true`.
- Définir une requête SQL permettant de calculer dynamiquement la valeur du champ.
- Cette requête peut être utilisée pour :
  - Afficher la valeur du champ dans une table.
  - Permettre le tri (`sortable`) et la recherche (`searchable`) si le champ est affiché via la metadata `ShowInTable`.

> ⚠️ Si aucune requête n’est fournie, la valeur du champ sera `null` par défaut.

---

## Requête SQL

La requête SQL permet de rendre un champ calculable exploitable dans l’interface (tri, recherche).

**Exemple :** champ `nombre_realisation_taches_en_cours` dans l'entité `Apprenant` :

```sql
SELECT count(*)
FROM realisation_taches rt
JOIN realisation_projets rp ON rt.realisation_projet_id = rp.id
JOIN etat_realisation_taches ert ON rt.etat_realisation_tache_id = ert.id
WHERE rp.apprenant_id = apprenants.id AND ert.nom = 'En cours'
```

---

## Étapes de Création d’un Champ Calculable

1. **Nom** : Nom du champ.
2. **Nom de la colonne / Relation** : 
   - Bien que les anciennes versions utilisaient des chemins relationnels (`competence.module.filiere_id`), la version actuelle privilégie une requête SQL directe.
3. **Valeur affichée** : Le résultat de la requête sera utilisé comme valeur du champ dans :
   - Le formulaire
   - Les colonnes de la table
4. **Attribut `calculable = true`**
5. **Requête SQL** : 
   - Obligatoire pour les fonctionnalités de tri et de recherche (avec `ShowInTable`).
   - Si absente, la valeur ne sera ni triable ni recherchable, et prendra `null`.

---

## Cas d’Usage : Ajout de `filiere_id` à l’entité `Formation`

- **Type** : `Integer`
- **Relation logique** : `formation → competence → module → filiere`
- **Requête SQL** :

```sql
SELECT m.filiere_id
FROM formations f
JOIN competences c ON f.competence_id = c.id
JOIN modules m ON c.module_id = m.id
WHERE f.id = formations.id
```

---


## Création d’un Champ avec `SelectOne`

Si le champ calculable est de type `Integer` et doit proposer un menu déroulant (select), on peut ajouter une metadata de type `Select`.

**Exemple :**

- Entité : `Formation`
- Champ : `filiere_id`
- Type : `Integer`
- Metadata à ajouter :

```json
//TODO : en construction, la configuration JSOn n'est pas correct
// la configuration doit détermine le DataSource : Function, JSON, Enumeration, 
// La détermination doit être avec NameSpace
{
  "name": "Select",
  "parameters": {
    "entity": "Filiere"
  }
}
```
