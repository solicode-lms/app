### **Tutoriel Complet : Déployer une Application Laravel sur un Serveur Ubuntu**

Ce guide vous accompagne étape par étape pour configurer un serveur Ubuntu et déployer une application Laravel. Chaque étape est expliquée avec des commandes et des explications claires.

---

### **Objectifs**
1. **Configurer le serveur Ubuntu** : Installer les outils nécessaires.
2. **Installer MySQL** : Configurer la base de données.
3. **Installer PHP et ses extensions** : Assurer la compatibilité avec Laravel.
4. **Configurer Nginx** : Héberger l’application Laravel.
5. **Installer Composer** : Gérer les dépendances de Laravel.
6. **Déployer Laravel** : Préparer et lancer l’application.

---

## **Étape 1 : Préparer le Serveur**
Avant de commencer, connectez-vous à votre serveur Ubuntu via SSH.

### 1.1 **Mettre à jour les paquets**
Mettez à jour les paquets et le système pour garantir que tout est à jour :
```bash
sudo apt update && sudo apt upgrade -y
```

### 1.2 **Installer les outils essentiels**
Installez les outils requis pour la configuration et la gestion du serveur :
```bash
sudo apt install curl zip unzip git software-properties-common -y
```

---

## **Étape 2 : Installer et Configurer MySQL**

### 2.1 **Installer MySQL**
Installez le serveur MySQL :
```bash
sudo apt install mysql-server -y
```

### 2.2 **Configurer une base de données pour Laravel**
1. Connectez-vous à MySQL en tant que root :
   ```bash
   sudo mysql
   ```
2. Créez une base de données et un utilisateur :
   ```sql
   CREATE DATABASE laravel_db;
   CREATE USER 'laravel_user'@'localhost' IDENTIFIED BY 'password';
   GRANT ALL PRIVILEGES ON laravel_db.* TO 'laravel_user'@'localhost';
   FLUSH PRIVILEGES;
   EXIT;
   ```

### 2.3 **Tester la connexion MySQL**
Assurez-vous que l’utilisateur a accès :
```bash
mysql -u laravel_user -p
```
Entrez le mot de passe **password** pour confirmer la connexion.

---

## **Étape 3 : Installer PHP et ses Extensions**

### 3.1 **Ajouter le dépôt PHP**
Ajoutez le dépôt officiel PHP pour installer la dernière version compatible avec Laravel :
```bash
sudo add-apt-repository ppa:ondrej/php -y
sudo apt update
```

### 3.2 **Installer PHP 8.2 et ses extensions**
Installez PHP et les extensions nécessaires pour Laravel :
```bash
sudo apt install php8.2 php8.2-fpm php8.2-mysql php8.2-curl php8.2-zip php8.2-mbstring php8.2-xml php8.2-bcmath php8.2-gd -y
```

### 3.3 **Redémarrer PHP-FPM**
Redémarrez le gestionnaire PHP-FPM pour activer les extensions :
```bash
sudo systemctl restart php8.2-fpm
```

### 3.4 **Vérifier l’installation de PHP**
Confirmez que PHP est correctement installé :
```bash
php -v
```

---

## **Étape 4 : Configurer Nginx pour Laravel**

### 4.1 **Installer Nginx**
Installez le serveur web Nginx :
```bash
sudo apt install nginx -y
```

### 4.2 **Créer une configuration Nginx pour Laravel**
1. Créez un fichier de configuration pour votre application Laravel :
   ```bash
   sudo nano /etc/nginx/sites-available/laravel
   ```
2. Ajoutez la configuration suivante :
   ```nginx
   server {
       listen 80;

       root /var/www/laravel/public;
       index index.php index.html;

       location / {
           try_files $uri $uri/ /index.php?$query_string;
       }

       location ~ \.php$ {
           include snippets/fastcgi-php.conf;
           fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
           fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
           include fastcgi_params;
       }

       location ~ /\.ht {
           deny all;
       }
   }
   ```

### 4.3 **Activer la configuration et redémarrer Nginx**
1. Activer la configuration :
   ```bash
   sudo ln -s /etc/nginx/sites-available/laravel /etc/nginx/sites-enabled/
   ```
2. Vérifier la configuration :
   ```bash
   sudo nginx -t
   ```
3. Redémarrer Nginx :
   ```bash
   sudo systemctl restart nginx
   ```

---

## **Étape 5 : Installer Composer**

### 5.1 **Installer Composer**
1. Téléchargez Composer :
   ```bash
   curl -sS https://getcomposer.org/installer | php
   ```
2. Déplacez Composer dans un répertoire accessible globalement :
   ```bash
   sudo mv composer.phar /usr/local/bin/composer
   ```

### 5.2 **Vérifier l’installation de Composer**
Assurez-vous que Composer est installé :
```bash
composer --version
```

---

## **Étape 6 : Déployer Laravel**

### 6.1 **Cloner le projet Laravel**
Cloner le dépôt Git de votre application Laravel :
```bash
sudo git clone https://github.com/votre-repo/laravel.git /var/www/laravel
```

### 6.2 **Configurer les permissions**
Attribuez les permissions nécessaires pour Laravel :
```bash
sudo chown -R www-data:www-data /var/www/laravel
sudo chmod -R 775 /var/www/laravel/storage /var/www/laravel/bootstrap/cache
```

### 6.3 **Installer les dépendances**
Installez les dépendances Laravel avec Composer :
```bash
cd /var/www/laravel
composer install
```

### 6.4 **Configurer le fichier `.env`**
1. Copiez le fichier d’exemple :
   ```bash
   cp .env.example .env
   ```
2. Configurez la base de données dans `.env` :
   ```env
   DB_CONNECTION=mysql
   DB_HOST=127.0.0.1
   DB_PORT=3306
   DB_DATABASE=laravel_db
   DB_USERNAME=laravel_user
   DB_PASSWORD=password
   ```
3. Générez la clé d’application :
   ```bash
   php artisan key:generate
   ```

### 6.5 **Migrer la base de données**
Exécutez les migrations pour créer les tables nécessaires :
```bash
php artisan migrate
```

---

## **Étape 7 : Tester l’Application Laravel**

### 7.1 **Tester localement avec Laravel**
Pour un test rapide, utilisez le serveur intégré de Laravel :
```bash
php artisan serve
```
Accédez à : `http://127.0.0.1:8000`.

### 7.2 **Tester avec Nginx**
Accédez à l’adresse IP de votre serveur ou au nom de domaine (ex. : `http://votre-domaine.com`).

---

## **Étape 8 : Sécuriser avec SSL (Facultatif)**

### 8.1 **Installer Certbot**
Installez Certbot pour gérer les certificats SSL :
```bash
sudo apt install certbot python3-certbot-nginx -y
```

### 8.2 **Générer un certificat SSL**
Configurez SSL pour votre domaine :
```bash
sudo certbot --nginx -d votre-domaine.com
```

### 8.3 **Tester le renouvellement automatique**
Confirmez que le renouvellement est configuré :
```bash
sudo certbot renew --dry-run
```

---

## **Résumé**
1. Configurez le serveur avec Nginx, PHP, et MySQL.
2. Installez Composer pour gérer Laravel.
3. Déployez l’application et configurez `.env`.
4. Sécurisez avec SSL si nécessaire.

Avec ces étapes, votre application Laravel est prête à fonctionner en production. Si vous rencontrez des problèmes, partagez les erreurs pour obtenir de l’aide !