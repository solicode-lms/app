sequenceDiagram
    participant PS as ProjetService
    participant MS as MobilisationUaService
    participant M as Model MobilisationUa
    participant TS as TacheService
    participant RPS as RealisationProjetService

    Note over PS, MS: Processus déclenché lors de la création d'un projet ou l'ajout d'une UA

    PS->>MS: create(data)
    MS->>M: create(data)
    M-->>MS: instance created

    MS->>MS: afterCreateRules(item)
    
    rect rgb(240, 248, 255)
        Note right of MS: 1. Génération des Tâches Tutoriels (N1)
        MS->>MS: Calculer maxOrdre et maxPriorite du projet
        loop Pour chaque Chapitre de l'UA
            MS->>TS: create(Task Data: "Tutoriel : {Chapitre}")
            TS-->>MS: Task created
            MS->>MS: Increment counters
        end
    end

    rect rgb(255, 250, 240)
        Note right of MS: 2. Synchronisation des Réalisations
        MS->>RPS: addMobilisationToProjectRealisations(projet_id, item)
        Note right of RPS: Ajoute les prototypes/projets (N2/N3) aux réalisations existantes des apprenants
        RPS-->>MS: done
    end

    rect rgb(245, 255, 245)
        Note right of MS: 3. Maintenance
        MS->>M: touch() (Project parent timestamp)
    end
