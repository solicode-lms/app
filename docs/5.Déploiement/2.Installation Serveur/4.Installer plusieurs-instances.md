
Probèlème avec SSL et port 2024, 
j'ai installer finallement 2024 sans ssl

Parfait, voici une **configuration complète Nginx** pour faire tourner **2 instances SoliLMS** en parallèle avec **SSL** :

* **main** : `https://192.168.100.230` (redirection HTTP→HTTPS sur :80)
* **V2024** : `https://192.168.100.230:2024` (redirection HTTP→HTTPS sur :2024)

> Adapte les chemins `root` et les chemins **certificat** si besoin. Remplace la version de PHP-FPM si tu n’es pas en 8.2.

---

# 1) `/etc/nginx/sites-available/solilms-main`

```conf

# HTTP → HTTPS (main)
server {
    listen 80;
    server_name 192.168.100.230 solicodetanger.ma www.solicodetanger.ma localhost;
    return 301 https://$host$request_uri;
}

# MAIN (HTTPS 443)
server {
    listen 443 ssl http2;
    server_name 192.168.100.230 solicodetanger.ma www.solicodetanger.ma localhost;

    root /var/www/solilms-main/public;
    index index.php index.html;
    charset utf-8;

    # SSL (remplacer par tes fichiers cert/clé)
    ssl_certificate     /etc/nginx/ssl/certificate.crt;
    ssl_certificate_key /etc/nginx/ssl/private.key;

    # Laravel front controller
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # PHP-FPM
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # Protéger les fichiers cachés (sauf .well-known)
    location ~ /\.(?!well-known).* {
        deny all;
    }

    error_page 404 /index.php;
    client_max_body_size 50M;
}
```

---

# 2) `/etc/nginx/sites-available/solilms-v2024`

```conf

# HTTP → HTTPS (port 2024)
server {
    listen 2024;
    server_name 192.168.100.230 localhost;
    return 301 https://$host:2024$request_uri;
}

# V2024 (HTTPS 2024)
server {
    listen 2024 ssl http2;
    server_name 192.168.100.230 localhost;

    root /var/www/solilms-v2024/public;
    index index.php index.html;
    charset utf-8;

    # SSL (mêmes fichiers, ou dédiés si tu veux)
    ssl_certificate     /etc/nginx/ssl/certificate.crt;
    ssl_certificate_key /etc/nginx/ssl/private.key;

    # Laravel front controller
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # PHP-FPM
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # Protéger les fichiers cachés (sauf .well-known)
    location ~ /\.(?!well-known).* {
        deny all;
    }

    error_page 404 /index.php;
    client_max_body_size 50M;
}
```

---

## 3) Activer les sites et recharger Nginx

```bash
sudo ln -s /etc/nginx/sites-available/solilms-main   /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/solilms-v2024  /etc/nginx/sites-enabled/

# Optionnel : désactiver le site par défaut s’il existe
sudo rm -f /etc/nginx/sites-enabled/default

# Ouvrir le port 2024 si firewall actif
sudo ufw allow 2024/tcp || true

# Vérifier et recharger
sudo nginx -t && sudo systemctl reload nginx
```

---

## 4) `.env` recommandés

**/var/www/solilms-main/.env**

```env
APP_NAME="SoliLMS Main"
APP_URL=https://192.168.100.230
```

**/var/www/solilms-v2024/.env**

```env
APP_NAME="SoliLMS V2024"
APP_URL=https://192.168.100.230:2024
```

> Pense à utiliser **2 bases** distinctes si tu veux séparer les données (ex: `solilms_main` et `solilms_v2024`).

---

## 5) Accès final

* Main : `https://192.168.100.230`
* V2024 : `https://192.168.100.230:2024`

Si tu veux **rester en HTTP** pour V2024 (sans SSL), dis-le moi et je te donne la variante (écoute sur `listen 2024;` et pas de blocs `ssl`).
