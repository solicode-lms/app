## ğŸ¯ Objectif

Simuler l'ajout d'un **projet** par un administrateur :
1. Connexion Ã  l'administration.
2. Ouverture du formulaire.
3. Remplissage des champs.
4. Soumission du formulaire.
5. VÃ©rification de l'ajout.

---

## ğŸ› ï¸ Ã‰tape 1 â€“ Installer Laravel Dusk

### 1.1 Ajouter le package
```bash
composer require --dev laravel/dusk
```

### 1.2 Initialiser Dusk
```bash
php artisan dusk:install
```
Cela crÃ©e :
- `tests/Browser/`
- `DuskTestCase.php`
- `.env.dusk.local`

---

## ğŸ› ProblÃ¨mes SSL frÃ©quents

### âœ… Erreur 1 : Avast bloque les connexions HTTPS
> **SymptÃ´me** : `SSL certificate problem: unable to get local issuer certificate`

**Solution** : *DÃ©sactive temporairement lâ€™analyse HTTPS* dans Avast (ou lâ€™antivirus concernÃ©).

---

### âœ… Erreur 2 : `cacert.pem` manquant

> **Message** : `cURL error 60: unable to get local issuer certificate`

**Solution** :
1. TÃ©lÃ©charge le certificat depuis :  
   [https://curl.se/ca/cacert.pem](https://curl.se/ca/cacert.pem)

2. Place-le dans :

   ```
   C:\php\bin\extras\cacert.pem
   ```

3. Dans `php.ini`, ajoute :
   ```ini
   curl.cainfo = "C:\php\bin\extras\cacert.pem"
   openssl.cafile = "C:\php\bin\extras\cacert.pem"
   ```

4. RedÃ©marre Apache ou le serveur PHP.

---

## ğŸ§ª Ã‰tape 2 â€“ CrÃ©er un test navigateur

```bash
php artisan dusk:make CreateProjetTest
```

Fichier gÃ©nÃ©rÃ© : `tests/Browser/CreateProjetTest.php`

---

## âœï¸ Ã‰tape 3 â€“ Exemple de test

```php
public function test_ajout_projet_depuis_interface_admin()
{
    $admin = \App\Models\User::factory()->create([
        'email' => 'admin@solicode.test',
    ]);

    $this->browse(function (Browser $browser) use ($admin) {
        $browser->loginAs($admin)
            ->visit('/admin/PkgCreationProjet/projets/create')
            ->assertSee('Ajouter un projet')
            ->type('titre', 'Projet Test UI')
            ->type('description', 'Test automatisÃ©')
            ->select('nature_livrable_id', 1)
            ->press('Enregistrer')
            ->assertPathIs('/admin/PkgCreationProjet/projets')
            ->assertSee('Projet Test UI');
    });
}
```

> âš ï¸ Adapte les champs (`titre`, `description`, etc.) Ã  ton formulaire.

---

## âš™ï¸ Ã‰tape 4 â€“ Configuration `.env.dusk.local`

```dotenv
APP_ENV=dusk
APP_URL=http://localhost
DB_CONNECTION=sqlite
DB_DATABASE=:memory:
```

> Tu peux aussi utiliser MySQL avec `DatabaseMigrations`.

---

## â–¶ï¸ Ã‰tape 5 â€“ Lancer les tests

```bash
php artisan dusk
```

Pour capturer une capture dâ€™Ã©cran :
```php
$browser->screenshot('formulaire-projet');
```

---

## ğŸ’¡ Astuces et bonnes pratiques

- ğŸ“· Captures dans `tests/Browser/screenshots/`
- âš ï¸ Logs JS : `tests/Browser/console/`
- ğŸ”„ Pour installer ou corriger ChromeDriver :
  ```bash
  php artisan dusk:chrome-driver
  ```

---

## ğŸ” Automatiser la connexion

CrÃ©e un composant de page avec :
```bash
php artisan dusk:page Login
```

