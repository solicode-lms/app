Voici un **tutoriel complet** pour installer **Nginx** et déployer une application **Laravel** sous **Windows 10** en utilisant `php-cgi` (car PHP-FPM n’est pas disponible sur Windows).

---

## 1️⃣ Télécharger et installer les prérequis

### 1.1 Installer PHP pour Windows

1. Va sur : [https://windows.php.net/download](https://windows.php.net/download)
2. Choisis la version **Non Thread Safe (NTS)** x64.
3. Décompresse dans `C:\php`.
4. Copie `php.ini-development` → `php.ini`.
5. Dans `php.ini`, décommente (supprime le `;`) pour activer :

   ```ini
   extension_dir = "ext"
   extension=fileinfo
   extension=mbstring
   extension=mysqli
   extension=pdo_mysql
   extension=curl
   extension=zip
   ```
6. Ajoute `C:\php` dans la variable d’environnement **PATH**.

---

### 1.2 Installer Composer

1. Télécharge l’installateur : [https://getcomposer.org/download](https://getcomposer.org/download)
2. Installe et teste :

   ```powershell
   composer -V
   ```

---

### 1.3 Installer MySQL ou MariaDB

* Télécharge et installe MariaDB : [https://mariadb.org/download](https://mariadb.org/download)
* Pendant l’installation, définis un mot de passe root.

---

### 1.4 Installer Nginx pour Windows

1. Télécharge : [http://nginx.org/en/download.html](http://nginx.org/en/download.html)
2. Décompresse dans `C:\nginx`.

---

## 2️⃣ Installer Laravel

### 2.1 Télécharger ton projet

```powershell
cd C:\nginx\html
git clone https://github.com/ton-repo/monapp.git
cd monapp
composer install --no-dev --optimize-autoloader
copy .env.example .env
php artisan key:generate
```

### 2.2 Configurer `.env`

```env
APP_NAME=Laravel
APP_ENV=production
APP_KEY=base64:...
APP_DEBUG=false
APP_URL=http://localhost

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=monapp
DB_USERNAME=root
DB_PASSWORD=root
```

### 2.3 Créer la base

```powershell
mysql -u root -p
CREATE DATABASE monapp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

### 2.4 Migrer et optimiser

```powershell
php artisan migrate --force
php artisan storage:link
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

---

## 3️⃣ Configurer PHP-CGI

### 3.1 Lancer PHP en FastCGI

Sous Windows, pas de `php-fpm.exe`, donc on utilise :

```powershell
cd C:\php
php-cgi.exe -b 127.0.0.1:9000
```

⚠️ Cette fenêtre doit rester ouverte pour traiter les requêtes PHP.

---

## 4️⃣ Configurer Nginx

Édite `C:\nginx\conf\nginx.conf` :

```nginx
worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  localhost;

        root   C:/nginx/html/monapp/public;
        index  index.php index.html;

        location / {
            try_files $uri $uri/ /index.php?$query_string;
        }

        location ~ \.php$ {
            include        fastcgi_params;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
        }

        location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
            expires 7d;
            access_log off;
        }
    }
}
```

---

## 5️⃣ Lancer les services

1. **Fenêtre 1** – PHP-CGI :

   ```powershell
   cd C:\php
   php-cgi.exe -b 127.0.0.1:9000
   ```

2. **Fenêtre 2** – Nginx :

   ```powershell
   cd C:\nginx
   start nginx
   ```

3. Ouvre ton navigateur : [http://localhost](http://localhost)

---

## 6️⃣ Automatiser le lancement

Crée un fichier `start_laravel.bat` :

```bat
@echo off
start "" php-cgi.exe -b 127.0.0.1:9000
timeout /t 2
start "" nginx.exe
pause
```

Place-le dans `C:\nginx` et double-clique pour lancer Nginx + PHP.

---

## 7️⃣ Scheduler et queue

### 7.1 Tâche planifiée Windows (Scheduler)

* Action : `php`
* Arguments : `artisan schedule:run`
* Démarrer dans : `C:\nginx\html\monapp`
* Planification : toutes les minutes.

### 7.2 Queue Worker

Installer [NSSM](https://nssm.cc/) et créer un service :

```powershell
nssm install laravel-queue "C:\php\php.exe" "artisan queue:work --sleep=3 --tries=3"
```

---

Si tu veux, je peux te préparer **un ZIP complet prêt à l’emploi** avec :

* Nginx déjà configuré
* Script `.bat` pour démarrage
* Laravel pointé sur `C:\nginx\html\monapp`

Veux-tu que je te prépare ce pack ?
