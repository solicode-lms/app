sequenceDiagram
    participant PS as ProjetService
    participant MS as MobilisationUaService
    participant MCT as MobilisationUaCrudTrait
    participant MRT as MobilisationUaRelationsTrait
    participant TS as TacheService

    Note over PS, MS: Processus déclenché lors de la création d'un projet ou l'ajout d'une UA

    PS->>MS: create(data)
    MS->>MCT: beforeCreateRules(data)
    MCT->>MCT: enrichDataWithUaCriteriaAndBareme(data)
    Note right of MCT: Calcul automatique des Critères et Barèmes (N2/N3)
    MCT-->>MS: data (ready)

    Note right of MS: Sauvegarde en BDD (Standard via Eloquent)

    MS->>MCT: afterCreateRules(item)
    activate MCT

    Note right of MCT: 1. Délégation : Création des tâches Tutoriels
    MCT->>TS: createTasksFromUa(projet_id, ua)
    activate TS
    TS-->>MCT: Tasks Created
    deactivate TS

    Note right of MCT: 2. Sync Tâches Projet
    MCT->>MRT: triggerSyncTacheEtRealisation(projet_id)
    activate MRT
    Note right of MRT: Mise à jour des notes et réalisations UA existantes
    MRT-->>MCT: done
    deactivate MRT

    Note right of MCT: 3. Maintenance (Touch Projet)

    MCT-->>MS: Fin Hook
    deactivate MCT
